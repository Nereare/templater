#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'repo_templater'

require 'pastel'
require 'tty-exit'
require 'tty-option'
require 'tty-prompt'

module RepoTemplater
  class Templater
    include TTY::Exit
    include TTY::Option

    flag :info do
      short '-i'
      long '--info'
      desc 'Show gem information'
    end

    flag :version do
      short '-v'
      long '--version'
      desc 'Show the version of the current installation'
    end

    flag :license do
      short '-l'
      long '--license'
      desc 'Show license information'
    end

    flag :help do
      short '-h'
      long '--help'
      desc 'Print help text'
    end

    usage do
      pastel = Pastel.new
      header "#{pastel.cyan(RepoTemplater::NAME)}"
      header "#{RepoTemplater::DESCRIPTION}"
      footer "Available under the #{pastel.green(RepoTemplater::LICENSE)} by #{pastel.blue(RepoTemplater::AUTHOR)}."
    end

    def run
      if params.errors.any?
        exit_with(:usage_error, params.errors.summary)
      else
        p = false
        p = 'version' if params[:version]
        p = 'license' if params[:license]
        p = 'help' if params[:help]

        case p
        when 'info'
          RepoTemplater::Actions.info
        when 'version'
          puts "#{RepoTemplater::VERSION}"
        when 'license'
          puts "#{RepoTemplater::LICENSE}"
        when 'help'
          puts help
        else
          RepoTemplater::Actions.run
        end
      end
    end
  end
end

cmd = RepoTemplater::Templater.new
cmd.parse(ARGV)
cmd.run
